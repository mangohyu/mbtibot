<!-- Please like <3 and share if you enjoyed! -->


  <div class="container" onclick="startSpin()">
    <h1 class="title">SOLT😱</h1>
    <div class="money-container">
      <div id="money">100</div>
      <div class="changes"> </div>
    </div>
    <div class="play-area">
      <div class="reel-container"></div>
      <div class="reel-container"></div>
      <div class="reel-container"></div>
    </div>
  
    <div class="info">
      <div class="instructions">
        한번 돌릴때마다<br/> 코인이 1개 소모됩니다. 💰<br/>코인에 당첨되려면 2줄 이상 당첨되세요!<br/></div>
  
      <div class="prize-table">
        <div class="doubles">
        </div>
        <div class="triples">
  
        </div>
      </div>
      <script>
        // Please like <3 and share if you enjoyed!
      
      let reelContents = ["😂", "😍", "😅", "🤔", "😜", "🤐", "😱", "😵"];
      let reelLength = 3;
      let reelContainers = document.querySelectorAll(".reel-container");
      let spinningReels = [];
      let spinning = false;
      let reelDelay = 100;
      
      let money = 100;
      let moneyToAdd = 0;
      
      let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      
      let masterVolume = audioCtx.createGain();
      masterVolume.gain.setValueAtTime(0.05, audioCtx.currentTime);
      masterVolume.connect(audioCtx.destination);
      
      let getReelItem = () => {
        let newReel = document.createElement("div");
        newReel.innerHTML =
        reelContents[Math.floor(Math.random() * reelContents.length)];
        newReel.classList.add("reel-item");
        setTimeout(() => {
          newReel.classList.add("active");
        }, 0);
      
        return newReel;
      };
      
      let startSpin = () => {
        if (!spinning && money > 0) {
          document.querySelectorAll(".prize-item.active").forEach(s => {
            s.classList.remove("active");
          });
          updateMoney(-1);
          setChange(-1);
          spinningReels.push(0);
          setTimeout(() => {
            spinningReels.push(1);
          }, reelDelay);
          setTimeout(() => {
            spinningReels.push(2);
          }, reelDelay * 2);
      
          spinning = true;
          spinUpdate(7);
        }
      };
      
      let spinUpdate = spinsLeft => {
        spinningReels.forEach(n => {
          moveReel(n);
        });
        if (spinsLeft > 0) {
          setTimeout(() => {
            spinUpdate(spinsLeft - 1);
          }, reelDelay);
        } else {
          if (spinningReels.length > 0) {
            spinningReels.shift();
      
            setTimeout(() => {
              spinUpdate(0);
            }, reelDelay);
            playNote(160 - (30 - spinningReels.length * 10), 0.1);
          } else {
            spinning = false;
            findWins();
          }
        }
      };
      
      let moveReel = reelIndex => {
        let selectedReel = reelContainers[reelIndex];
        selectedReel.prepend(getReelItem());
        if (selectedReel.children.length > reelLength) {
          selectedReel.lastElementChild.classList.add("deactivate");
          setTimeout(() => {
            selectedReel.removeChild(selectedReel.lastElementChild);
          }, reelDelay);
        }
      };
      
      let updateMoney = change => {
        money += change;
        document.querySelector("#money").innerText = money;
      };
      
      let setChange = change => {
        let changes = document.querySelector(".changes");
        let newChange = document.createElement("div");
        newChange.innerHTML = change > 0 ? `+${change}` : change;
        newChange.classList.add("change");
        if (change < 0) newChange.classList.add("negative");
        changes.prepend(newChange);
        if (changes.children.length > 6) {
          changes.removeChild(changes.lastElementChild);
        }
      };
      
      let playWinChime = amount => {
        let clampedAm = amount > 20 ? 20 : amount;
        playNote(400 + 100 * (20 - clampedAm), 0.05, "sine");
        if (--amount > 0)
        setTimeout(() => {
          playWinChime(amount);
        }, 70);
      };
      
      let findWins = () => {
        let winline = [];
        let symbols = {};
        reelContainers.forEach(reel => {
          let symbol = reel.children[1].innerText;
          winline.push(symbol);
          if (symbols[symbol]) symbols[symbol]++;else
          symbols[symbol] = 1;
        });
      
        if (
        winline.filter(s => {
          return s === winline[0];
        }).length === 3)
        {
          win(3, winline[0]);
          document.
          querySelector(".triples").
          children[reelContents.indexOf(winline[0])].classList.add("active");
        } else {
          for (s in symbols) {
            if (symbols[s] == 2) {
              win(2, s);
              document.
              querySelector(".doubles").
              children[reelContents.indexOf(s)].classList.add("active");
            }
          }
        }
      };
      
      let win = (amountMatching, symbol) => {
        reelContainers.forEach(reel => {
          if (reel.children[1].innerText === symbol)
          reel.children[1].classList.add("win");
        });
        let winAmount = 1 + reelContents.indexOf(symbol);
        playWinChime(winAmount);
        if (amountMatching == 3) winAmount *= 100;
      
        setChange(winAmount);
        addToMoney(winAmount);
      };
      
      let addToMoney = (amount, speed) => {
        let changeAmount = Math.ceil(amount / 2);
        updateMoney(changeAmount);
        let remainder = amount - changeAmount;
        if (!speed) speed = 101;
        speed -= 5;
        if (speed < 10) speed = 10;
        if (remainder)
        setTimeout(() => {
          addToMoney(remainder);
        }, speed);
      };
      
      function playNote(freq, dur, type) {
        if (!freq) freq = 1000;
        if (!dur) dur = 1;
        if (!type) type = "square";
        return new Promise(res => {
          let oscillator = audioCtx.createOscillator();
          oscillator.type = type;
          oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime); // value in hertz
          oscillator.connect(masterVolume);
          oscillator.start();
          oscillator.stop(audioCtx.currentTime + dur);
          oscillator.onended = res;
        });
      }
      
      //fills reels
      reelContainers.forEach((reel, i) => {
        for (let n = 0; n < reelLength; n++) {if (window.CP.shouldStopExecution(0)) break;
          moveReel(i);
        }window.CP.exitedLoop(0);
      });
      
      let addToPrizeTable = (combo, amount, target) => {
        let pt = document.querySelector(`.prize-table .${target}`);
        let prize = document.createElement("div");
        prize.innerHTML = `${combo}: ${amount}`;
        prize.classList.add("prize-item");
        prize.setAttribute("win-attr", combo.replace(/[-❔]/g, ""));
        pt.append(prize);
      };
      
      //fill prize table
      reelContents.forEach((symbol, index) => {
        addToPrizeTable(`${symbol}-${symbol}-❔`, index + 1, "doubles");
      });
      
      reelContents.forEach((symbol, index) => {
        addToPrizeTable(
        `${symbol}-${symbol}-${symbol}`,
        (index + 1) * 100,
        "triples");
      
      });
        </script>
<style>
@charset "UTF-8";
body {
  margin: 0;
  background: #9bbbd4;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  cursor: pointer;
}

.container {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-items: center;
  justify-content: center;
}
.container .title {
  font-family: "돋움", cursive;
  font-size: 3rem;
  color: white;
  text-decoration: underline;
}
.container .money-container {
  position: relative;
  margin-bottom: 0.5rem;
  font-family: "돋움", sans-serif;
  color: white;
}
.container .money-container .changes {
  position: absolute;
  display: inline-flex;
  top: 1rem;
  font-weight: bold;
}
.container .money-container .changes .change {
  color: #044600;
  padding-left: 0.5rem;
  -webkit-animation-duration: 1s;
          animation-duration: 1s;
  -webkit-animation-name: slideinLeft;
          animation-name: slideinLeft;
  -webkit-animation-fill-mode: forwards;
          animation-fill-mode: forwards;
}
.container .money-container .changes .change.negative {
  color: #860000;
}
.container .money-container .changes .change:nth-child(1) {
  opacity: 0.85;
}
.container .money-container .changes .change:nth-child(2) {
  opacity: 0.7;
}
.container .money-container .changes .change:nth-child(3) {
  opacity: 0.55;
}
.container .money-container .changes .change:nth-child(4) {
  opacity: 0.4;
}
.container .money-container .changes .change:nth-child(5) {
  opacity: 0.25;
}
.container .money-container .changes .change:nth-child(6) {
  opacity: 0.1;
}
.container .money-container .changes .change:nth-child(7) {
  opacity: -0.05;
}
.container .money-container .changes .change:nth-child(8) {
  opacity: -0.2;
}
.container .money-container #money {
  font-size: 2rem;
  display: inline;
  margin-left: -8rem;
  font-weight: bold;
}
.container .money-container #money:before {
  content: "💰 ";
}
.container .play-area {
  position: relative;
  display: flex;
  background-image: linear-gradient(45deg, #edfaf9 18.75%, #b3d5eb 18.75%, #b3d5eb 50%, #edfaf9 50%, #edfaf9 68.75%, #b3d5eb 68.75%, #b3d5eb 100%);
  background-size: 56.57px 56.57px;
  min-height: 12.5rem;
  border: solid #1e1e1e 5px;
}
.container .play-area .reel-container {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  display: flex;
  justify-content: center;
  flex-direction: column;
  height: 12.5rem;
  overflow: hidden;
  align-items: center;
  width: 4rem;
  padding-left: 1rem;
  padding-right: 1rem;
}
.container .play-area .reel-container:first-child {
  border-right: solid #1e1e1e 3px;
}
.container .play-area .reel-container:last-child {
  border-left: solid #1e1e1e 3px;
}
.container .play-area .reel-container .reel-item {
  font-size: 3rem;
  -webkit-animation-duration: 0.1s;
          animation-duration: 0.1s;
  -webkit-animation-name: slidein;
          animation-name: slidein;
}
.container .play-area .reel-container .reel-item.deactivate {
  -webkit-animation-duration: 0.1s;
          animation-duration: 0.1s;
  -webkit-animation-name: slideOut;
          animation-name: slideOut;
  -webkit-animation-fill-mode: forwards;
          animation-fill-mode: forwards;
}
.container .play-area .reel-container .reel-item.win {
  -webkit-animation: winFlashReels 1s infinite;
          animation: winFlashReels 1s infinite;
  border-radius: 50%;
}
.container .play-area:before {
  position: absolute;
  content: "";
  width: 0;
  height: 0;
  top: calc(50% - 8px);
  border-top: 10px solid transparent;
  border-bottom: 10px solid transparent;
  border-left: 15px solid #1e1e1e;
}
.container .play-area:after {
  position: absolute;
  content: "";
  width: 0;
  height: 0;
  right: 0;
  top: calc(50% - 8px);
  border-top: 10px solid transparent;
  border-bottom: 10px solid transparent;
  border-right: 15px solid #1e1e1e;
}
.container .info {
  padding-top: 1rem;
  padding-bottom: 3rem;
}
.container .info .instructions {
  color: white;
  margin-bottom: 1rem;
  width: 500px;
  text-align: center;
  font-family: "돋움", cursive;
}
.container .info .prize-table {
  width: 320px;
  margin-left: auto;
  margin-right: auto;
  display: flex;
  justify-content: space-between;
  color: white;
  font-weight: bold;
  font-family: "돋움", sans-serif;
  font-size: 1.3rem;
}
.container .info .prize-table .doubles {
  padding-right: 2rem;
}
.container .info .prize-table .prize-item {
  opacity: 0.4;
  margin-bottom: 0.2rem;
}
.container .info .prize-table .prize-item.active {
  opacity: 1;
  -webkit-animation: winFlashPrizeTable 1s infinite;
          animation: winFlashPrizeTable 1s infinite;
}

@-webkit-keyframes slidein {
  from {
    font-size: 0.1rem;
    opacity: 0;
  }
  to {
    font-size: 3rem;
    opacity: 1;
  }
}

@keyframes slidein {
  from {
    font-size: 0.1rem;
    opacity: 0;
  }
  to {
    font-size: 3rem;
    opacity: 1;
  }
}
@-webkit-keyframes slideOut {
  to {
    height: 0;
    font-size: 0.1rem;
    opacity: 0;
  }
  from {
    height: 3rem;
    font-size: 3rem;
    opacity: 1;
  }
}
@keyframes slideOut {
  to {
    height: 0;
    font-size: 0.1rem;
    opacity: 0;
  }
  from {
    height: 3rem;
    font-size: 3rem;
    opacity: 1;
  }
}
@-webkit-keyframes winFlashReels {
  0% {
    background-color: rgba(240, 240, 240, 0.2);
  }
  50% {
    background-color: #14c814;
  }
  100% {
    background-color: rgba(240, 240, 240, 0.2);
  }
}
@keyframes winFlashReels {
  0% {
    background-color: rgba(240, 240, 240, 0.2);
  }
  50% {
    background-color: #14c814;
  }
  100% {
    background-color: rgba(240, 240, 240, 0.2);
  }
}
@-webkit-keyframes winFlashPrizeTable {
  0% {
    opacity: 0.2;
  }
  50% {
    opacity: 1;
  }
  100% {
    opacity: 0.2;
  }
}
@keyframes winFlashPrizeTable {
  0% {
    opacity: 0.2;
  }
  50% {
    opacity: 1;
  }
  100% {
    opacity: 0.2;
  }
}
@-webkit-keyframes slideinLeft {
  to {
    font-size: 1rem;
  }
  from {
    font-size: 0rem;
  }
}
@keyframes slideinLeft {
  to {
    font-size: 1rem;
  }
  from {
    font-size: 0rem;
  }
}
</style>